<div class="h-full bg-[#F5F5DC] overflow-hidden flex flex-col">
  <!-- HEADER -->
  <div class="shrink-0">
    <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
      <div>
        <h2 class="text-xl sm:text-2xl font-black text-[#4B3621]">Inventario</h2>
        <p class="text-sm text-[#6E5C4B]">
          Crea, actualiza, activa o desactiva tus productos
        </p>
      </div>

      <!-- Filtros -->
      <div class="flex flex-col sm:flex-row gap-2 sm:items-end">
        <div>
          <label class="block text-xs font-bold text-[#6E5C4B] mb-1">Mostrar</label>
          <select
            class="h-12 rounded-xl border border-[#8B6F47]/40 bg-white/80 px-4 text-sm text-[#4B3621] outline-none focus:border-[#4B3621]"
            [(ngModel)]="filterActive"
            (change)="page = 1; loadProducts()"
          >
            <option value="all">Todos</option>
            <option value="true">Activos</option>
            <option value="false">Inactivos</option>
          </select>
        </div>

        <div class="min-w-[260px]">
          <label class="block text-xs font-bold text-[#6E5C4B] mb-1">Buscar</label>
          <input
            type="text"
            class="h-12 w-full rounded-xl border border-[#8B6F47]/40 bg-white/80 px-4 text-sm sm:text-base text-[#4B3621] outline-none focus:border-[#4B3621]"
            placeholder="Nombre del producto..."
            [(ngModel)]="query"
            (keydown.enter)="search()"
          />
        </div>

        <button
          type="button"
          (click)="search()"
          class="h-12 rounded-xl bg-[#4B3621] px-6 text-sm sm:text-base font-extrabold text-[#F5F5DC] hover:opacity-95 active:scale-[0.99]"
        >
          Buscar
        </button>
      </div>
    </div>
  </div>

  <!-- CREAR PRODUCTO -->
  <div class="shrink-0">
    <div class="mt-5 rounded-2xl border border-[#4B3621]/15 bg-white/70 p-4">
      <h3 class="text-sm sm:text-base font-extrabold text-[#4B3621]">Crear producto</h3>

      <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3">
        <input
          type="text"
          placeholder="Nombre"
          class="h-12 px-4 rounded-xl border border-[#8B6F47]/40 bg-white/80 text-[#4B3621] outline-none focus:border-[#4B3621]"
          [(ngModel)]="newName"
        />

        <input
          type="number"
          placeholder="Precio"
          class="h-12 px-4 rounded-xl border border-[#8B6F47]/40 bg-white/80 text-[#4B3621] outline-none focus:border-[#4B3621]"
          [(ngModel)]="newPrice"
        />

        <input
          type="number"
          placeholder="Stock"
          class="h-12 px-4 rounded-xl border border-[#8B6F47]/40 bg-white/80 text-[#4B3621] outline-none focus:border-[#4B3621]"
          [(ngModel)]="newStock"
        />
      </div>

      <div class="mt-3 flex items-center justify-between gap-3 flex-wrap">
        <button
          type="button"
          (click)="createProduct()"
          [disabled]="creating"
          class="h-12 rounded-xl bg-[#FFBF00] px-6 text-sm sm:text-base font-extrabold text-[#4B3621] hover:brightness-95 active:scale-[0.99] disabled:opacity-60"
        >
          @if (creating) { Creando... } @else { Crear }
        </button>

        @if (createMsg) {
          <p class="text-sm text-[#6E5C4B]">{{ createMsg }}</p>
        }
      </div>
    </div>
  </div>

  <!-- LISTA / TABLA -->
  @if (loading) {
    <div class="mt-5 rounded-2xl border border-[#4B3621]/15 bg-white/70 p-6">
      <p class="text-sm text-[#6E5C4B]">Cargando productos...</p>
    </div>
  } @else if (errorMsg) {
    <div class="mt-5 rounded-2xl border border-red-500/20 bg-red-50 p-6">
      <p class="text-sm text-red-700">{{ errorMsg }}</p>
    </div>
  } @else {

    @if (products.length === 0) {
      <div class="mt-5 rounded-2xl border border-[#4B3621]/15 bg-white/70 p-6">
        <p class="text-sm text-[#6E5C4B]">No hay productos para mostrar.</p>
      </div>
    } @else {

      <div class="flex-1 min-h-0 overflow-hidden mt-5">
        <div class="h-full rounded-2xl border border-[#4B3621]/15 bg-white/70 overflow-hidden flex flex-col">
          <div class="flex-1 min-h-0 overflow-auto">
            <table class="w-full text-left">
              <thead class="bg-[#4B3621] text-[#F5F5DC] sticky top-0 z-10">
                <tr>
                  <th class="px-4 py-3 text-xs font-black uppercase tracking-wide">Producto</th>
                  <th class="px-4 py-3 text-xs font-black uppercase tracking-wide">Precio</th>
                  <th class="px-4 py-3 text-xs font-black uppercase tracking-wide">Stock</th>
                  <th class="px-4 py-3 text-xs font-black uppercase tracking-wide">Estado</th>
                  <th class="px-4 py-3 text-xs font-black uppercase tracking-wide text-right">Acciones</th>
                </tr>
              </thead>

              <tbody>
                @for (p of products; track p.id) {
                  <tr class="border-t border-[#4B3621]/10">
                    <td class="px-4 py-3">
                      <p class="text-sm font-extrabold text-[#4B3621]">{{ p.name }}</p>
                      <p class="text-xs text-[#6E5C4B]">ID: {{ p.id }}</p>
                    </td>

                    <td class="px-4 py-3 text-sm font-black text-[#4B3621] whitespace-nowrap">
                      ${{ p.price }}
                    </td>

                    <td class="px-4 py-3 text-sm text-[#6E5C4B] whitespace-nowrap">
                      {{ p.stock }}
                    </td>

                    <td class="px-4 py-3">
                      <span
                        class="inline-flex rounded-full px-3 py-1 text-xs font-black"
                        [class]="p.active ? 'bg-[#FFBF00]/30 text-[#4B3621]' : 'bg-red-100 text-red-700'"
                      >
                        {{ p.active ? 'ACTIVO' : 'INACTIVO' }}
                      </span>
                    </td>

                    <td class="px-4 py-3 text-right">
                      @if (editingId === p.id) {
                        <div class="flex flex-col sm:flex-row gap-2 sm:items-center justify-end">
                          <input
                            type="number"
                            class="h-11 w-full sm:w-28 rounded-xl border border-[#8B6F47]/40 bg-white px-3 text-sm text-[#4B3621] outline-none focus:border-[#4B3621]"
                            [(ngModel)]="editPrice"
                            placeholder="Precio"
                          />
                          <input
                            type="number"
                            class="h-11 w-full sm:w-28 rounded-xl border border-[#8B6F47]/40 bg-white px-3 text-sm text-[#4B3621] outline-none focus:border-[#4B3621]"
                            [(ngModel)]="editStock"
                            placeholder="Stock"
                          />

                          <button
                            type="button"
                            (click)="saveEdit(p)"
                            [disabled]="saving"
                            class="h-11 rounded-xl bg-[#FFBF00] px-4 text-sm font-extrabold text-[#4B3621] hover:brightness-95 disabled:opacity-60"
                          >
                            @if (saving) { Guardando... } @else { Guardar }
                          </button>

                          <button
                            type="button"
                            (click)="cancelEdit()"
                            class="h-11 rounded-xl border border-[#4B3621]/25 bg-white px-4 text-sm font-extrabold text-[#4B3621] hover:bg-[#F5F5DC]"
                          >
                            Cancelar
                          </button>
                        </div>

                        @if (saveMsg) {
                          <p class="mt-2 text-sm text-[#6E5C4B] text-right">{{ saveMsg }}</p>
                        }
                      } @else {
                        <div class="flex gap-2 justify-end">
                          <button
                            type="button"
                            (click)="startEdit(p)"
                            class="h-11 rounded-xl border border-[#4B3621]/25 bg-white px-4 text-sm font-extrabold text-[#4B3621] hover:bg-[#F5F5DC]"
                          >
                            Editar
                          </button>

                          @if (p.active) {
                            <button
                              type="button"
                              (click)="deactivate(p)"
                              class="h-11 rounded-xl bg-red-600 px-4 text-sm font-extrabold text-white hover:opacity-95"
                            >
                              Desactivar
                            </button>
                          } @else {
                            <button
                              type="button"
                              (click)="activate(p)"
                              class="h-11 rounded-xl bg-[#4B3621] px-4 text-sm font-extrabold text-[#F5F5DC] hover:opacity-95"
                            >
                              Activar
                            </button>
                          }
                        </div>
                      }
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

          <!-- PAGINACIÓN -->
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 px-4 py-3 border-t border-[#4B3621]/10">
            <p class="text-xs sm:text-sm text-[#6E5C4B]">
              Página <span class="font-black text-[#4B3621]">{{ page }}</span> de
              <span class="font-black text-[#4B3621]">{{ totalPages }}</span>
              · Total: <span class="font-black text-[#4B3621]">{{ total }}</span>
            </p>

            <div class="flex gap-2">
              <button
                type="button"
                (click)="prevPage()"
                [disabled]="page <= 1"
                class="h-11 rounded-xl border border-[#4B3621]/25 bg-white px-4 text-sm font-extrabold text-[#4B3621] hover:bg-[#F5F5DC] disabled:opacity-50"
              >
                Anterior
              </button>
              <button
                type="button"
                (click)="nextPage()"
                [disabled]="page >= totalPages"
                class="h-11 rounded-xl bg-[#FFBF00] px-4 text-sm font-extrabold text-[#4B3621] hover:brightness-95 disabled:opacity-50"
              >
                Siguiente
              </button>
            </div>
          </div>
        </div>
      </div>
    }
  }
</div>